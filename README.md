# gRPC Auth Service

WIP

Аутентификационный сервис на Go с использованием gRPC, построенный по принципам Clean Architecture.

Проект демонстрирует навыки: архитектурное мышление, разделение слоёв, тестирование, работу с инфраструктурой (PostgreSQL, Redis) и реализацию полноценного auth-flow (JWT + refresh tokens).

---

## О проекте

Сервис предоставляет gRPC API для:

- Регистрации пользователя
- Аутентификации (логин)
- Выдачи access и refresh токенов
- Обновления access токена
- Валидации сессии

Проект не является CRUD-примером - реализована полноценная логика управления сессиями, хранение токенов, кэширование и тестирование бизнес-логики.

---

## Архитектура

Проект реализован с разделением ответственности по слоям (Clean Architecture):

cmd/ - точка входа приложения
internal/
domain/ - доменные сущности
usecase/ - бизнес-логика
repository/ - интерфейсы (абстракции)
infrastructure/ - реализации (SQL, Redis)
grpc/ - транспортный слой
config/ - конфигурация и логирование
provider/ - реализация токен-провайдера
proto/ - gRPC контракт
migrations/ - схема базы данных
mocks/ - моки для тестирования


### Принципы

- Dependency Inversion
- Чёткое разделение слоёв
- Бизнес-логика не зависит от инфраструктуры
- Использование интерфейсов для изоляции зависимостей
- Возможность тестирования usecase без реальной БД

---

## Используемые технологии

- Go
- gRPC
- PostgreSQL
- Redis
- JWT
- golangci-lint
- testify (тестирование)
- mock generation
- SQL migrations

---

## Реализованный Auth Flow

### Логин

1. Проверка учётных данных
2. Верификация пароля
3. Генерация access и refresh токенов
4. Создание сессии в PostgreSQL
5. Кэширование сессии в Redis

### Обновление токена

1. Валидация refresh токена
2. Проверка существования сессии
3. Генерация нового access токена
4. Обновление данных сессии

---

## Тестирование

В проекте реализованы:

- Unit-тесты бизнес-логики
- Unit-тесты SQL-репозиториев
- Интеграционные тесты
- Использование моков для изоляции зависимостей
- Тестирование токен-провайдера

Фокус тестирования:
- корректность auth-flow
- поведение при ошибках
- корректность работы инфраструктуры

---

## Конфигурация

Настройки сервиса задаются через:

- `config.toml`
- `.env` (при необходимости)

---

## Запуск

Все необходимые команды указаны в Makefile
